#clickhouse 

Наследует функциональность [[MergeTree]]. Отличие заключается в том, что при слиянии кусков данных  все строки с одинаковым [[Ключ Сортировки|ключом сортировки]] заменяются на одну, которая хранит только суммы значений из столбцов с цифровым типом данных.

Рекомендуюется использовать совместно с [[MergeTree]]:
1. В [[MergeTree]] хранить полные данные;
2. В [[SummingMergeTree]] хранить аггрегированные данные, извлеченые из [[MergeTree]].

## Обработка данных

При вставке данные сохраняются как есть. С некоторой периодичностью СУБД сливает вставленные куски данных и именно в этот момент производится суммирование и замена многих строк с одинаковым ключом сортировки на одну для каждого результирующего куска данных.

Слияние кусков данных может произойти таким образом, что не все строки с одинаковым ключом сортировки окажутся в одном куске. Таким образом суммирования будет неполным. Поэтому необходимо использовать агрегатную функцию  **sum()** и **GROUP BY**.

## Общие правила суммирования

1. Суммируются значения в столбцах с числовым типом данных. Набор столбцов определяется параметром `columns`.

2. Если значения во всех столбцах для суммирования оказались нулевыми, то строчка удаляется.

3. Для столбцов, не входящих в первичный ключ и не суммирующихся, выбирается произвольное значение из имеющихся.

4. Значения для столбцов, входящих в первичный ключ, не суммируются

[[MergeTree Family]]
