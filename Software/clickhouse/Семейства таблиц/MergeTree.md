#clickhouse 

Основная идея - быстро записать данные по частям, а затем в фоновом процессе объединить эти части в фоновом режиме по некоторым правилам

## Основные возможности
1. Данные хранятся отсортированные по первичному ключу
2. Оперирование партициями, если задан [[ключ партиционирования]]
3. Поддержка репликации данных
4. Поддержка [[сэмплирование|сэмплирования]] данных

## Хранение данных в MergeTree

Таблица состоит из кусков данных (data parts) отсортированных по первичному ключу.

Куски данных создаются при записи данных в таблицу. Clickhouse в фоновом режиме занимается слиянием этих кусков. Это позволяет более эффективного хранить данные.

Куски данных могут храниться в двух форматах:
1. **Compact** - каждый столбец куска хранится в отдельном файле
2. **Wide** - все столбцы лежат в одном одном файле

**Compact** лучше использовать для повышения производительности при частом обновлении небольших объемов данныхю

Каждый кусок данных разбит на **гранулы**. **Гранула** - это минимальный неделимый набор данных, который полностью читается Clickhouse при выгрузке данных. Гранула всегда содержит целое число строка.

### Пример

Рассмотрим следующий пример, где первичный ключ - `(CounterID, Date)`. В этом случае сортировку и индекс можно представить следующим образом.

![[Pasted image 20230217142801.png]]

В начале каждой гранулы ставится засечка - щначение первичного ключа для этой строки. Размер гранулы задается параметрами `index_granularity` и `index_granularity_bytes`.

[[Выбор первичного ключа]]
[[Использование индексов]]

Источник: [MergeTree](https://clickhouse.com/docs/ru/engines/table-engines/mergetree-family/mergetree)